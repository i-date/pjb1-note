# VBAのはじめの一歩

## 基本

- 特徴
  - Excelを操作するための言語
  - 基本はオブジェクト指向
  - オブジェクト指向ではない箇所も混在
  - 良し悪しあるが「わりといいかげん」でも動く

- 仕組みの整理
  - Excel機能の自動化
  - プログラムの流れの変更
  - Excelだけでは実現できない作業の自動化(機能拡張)
  - 専用のUI作成

- 作業フェーズ
  - データベース
  - 入力・インプット
  - 演算・処理・加工整形
  - 出力・アウトプット
  - シェア

- 作成方法
  - マクロの記録→確認に使用、条件分岐などができない
  - プログラミング

- 処理の組み合わせ
  - 繰り返し処理
  - 判定処理
  - データ処理

- VBEのウィンドウ例
  - モジュールウィンドウ: Book内のモジュール構成を確認と編集する際に使用
  - プロパティウィンドウ: 主にユーザーフォームのコントロール設定に使用
  - コードウィンドウ: プログラムを記述編集する際に使用、メイン
  - イミディエイトウインドウ: いわゆるコンソール

- モジュール: 基本的には標準モジュール（Book全体で使用可能）、挿入→標準モジュール
  - 標準モジュール: Book全体で使用可能
  - オブジェクトモジュール: 主にイベント処理を記述
  - クラスモジュール
- プロシージャ: マクロの最小単位(サブルーチンのこと?)

  ```vba
  Sub 名前()
    処理
  End Sub
  ```

- 2種類のプロパティ
  - オブジェクトを返す
  - 値を返す

- オブジェクトは、階層構造を持つものも存在
- オブジェクトは下記を持つ
  - プロパティ(属性)
  - メソッド(命令)

- 3要素
  - 関数: オブジェクトに依存せずに呼び出せる、依存するのはメソッド
  - ステートメント: マクロ動作を制御する命令
  - オブジェクト式: エクセルを操作するときのコードの記述方法
    - プロパティ: `オブジェクト.プロパティ = 値`→`Range("A").Value = 100`
    - メソッド: `オブジェクト.メソッド オプション`→`Range("A").Delete Shift:=xlToLeft`

- 3種類の値の記述方法
  1. 数値: そのまま記述
  2. 文字列: `"`ダブルクォーテーションで囲む
  3. 日付・時刻: `#`ハッシュで囲む

- 型注意
  - 配列
    - 静的配列
    - 動的配列
  - Variant型: Splitが使用可能、インデックスは1開始

- ステートメント: VBAコードの「1行ひとかたまり」

- VBAは大文字・小文字を区別「しない」言語

## 基本構文

- コメント化: `'`シングルクォーテーション以降がコメントとして扱われる
- ステートメントの改行:スペース+ `_`アンダーバーを行末に記述
- Debug.Print: 糖衣構文`?`がイミディエイトウインドウで使用できる

- 選択: 特定範囲の場合`Range`、状況に応じて変化する場合`Cells`
- コレクション: メンバー指定には`オブジェクト名+s複数形`で、インデックス番号もしくは名前を指定
  - `Range(アドレス文字列)`: セル範囲をまとめて指定できることが前提として作られた、「プロパティ」
    - `Range("A1")`
    - `Range("A1").Range("B2")`: 相対参照、ここではA1を基準にB2移動と同じ分移動
  - `Range("A1:C5")`or`Range("A1","C5")`
  - `Cells(2,3)`or`Cells(2,"C")`
  - `Rows(行数)`: 行指定
  - `Columns(列名)`: 列指定
    - 列を数値で指定したい場合: `Range(Columns(1), Columns(4+1))`
  - `Worksheets("シート名")`or`Worksheets(左からの順番)`
    - Sheetsは、挿入時に選択できる4種類すべてを対象
    - WorkSheetsは、ワークシートのみ
  - `Workbooks("ブック名+拡張子")`or`Workbooks(開いた順番)`

- プロパティ
  - Value: セルの値
  - Text: セルに表示されている値(カンマなどが含まれる)
  - End: control+shift+方向キーの処理
  - Offset: 基準となるセルからの位置
  - ActiveCell: アクティブセルを表すRangeオブジェクトを返す
  - Selection: 選択しているセル(範囲)を返す
  - Count: 数を返す

- メソッド: `オブジェクト.メソッド 引数名:=値, ...`(引数は省略可能なものも存在、組み込み定数)
  - Active: アクティブセルをどこにするか選択、複数選択でもアクティブセルは一つ
  - Select: 指定したオブジェクトを選択
  - Copy: コピー&ペースト`コピー元セル.Copy Destination:=コピー先のセル`(`Destination:=`は省略可能)
  - PasteSpecial: 形式を選択して貼り付け`ペースト先.PasteSpecial paste:=フォーマット形式`(`paste:=`は省略可能)
  - Clear: 削除
  - ClearFormats: 書式だけ削除
  - ClearContents: 値だけ削除
  - Delete: オブジェクトごと削除、右クリックから削除を選択した場合の処理`セル.Delete shift:=フォーマット形式`(`shift:=`は省略可能)
  - Close: ブックを閉じる
  - Open: 引数にpath¥ファイル名+拡張子

- 変数: 宣言的
  - `Option Explicit`: 最初の行で指定した場合、変数を宣言しないと使用できない
  - モジュールレベル変数: 宣言セクションで指定した変数、マクロが停止するまで値を保持
  - `Dim 変数名 As データ型`
  - `Public 変数名 As データ型`
  - 代入
    - Set: オブジェクトを代入する時
    - Let: リテラル(値)を代入する時(Letは省略される)
    - 宣言と代入を一行出する場合: `Dim 変数名 As データ型: 変数名 = 値`
  - 配列
    - 0から始める場合:   `Dim 配列名(要素数-1) As データ型`
    - 0から始めない場合: `Dim 配列名(1 To 要素数) As データ型`

- 定数
  - `Const 定数名 As データ型 = 値`

- ステートメント制御
  - For ~ Next

    ```vba
    Dim 変数名 As データ型
    For 変数 = 初期値 To 終了値 Step 増分/差分
      処理
    Next 変数
    ```

  - For Each

    ```vba
    Dim メンバー変数名 As データ型
    For Each メンバー変数名 In リスト
      処理
    Next 変数
    ```

  - If

    ```vba
    If 条件 Then 処理

    または

    If 条件1 Then
      条件1を満たした場合の処理
    ElseIf 条件2 Then
      条件2を満たした場合の処理
    Else
      何も満たしてない場合の処理
    End If
    ```

  - Select Case

    ```vba
    Select Case 値
      Case 条件1
        処理
      Case 条件2, 条件3
        処理
      Case Else
        その他の処理
    End Select

    条件で比較する場合: Case Is >= 10000
    ```

  - Do Loop: 無限ループにならないように注意
    - 条件 Until: 条件がfalseの間ループ
    - 条件 While: 条件がtrueの間ループ

    ```vba
    前判定
    Do 条件
      処理
    Loop

    後判定: 最低ループ一回を保証
    Do
      処理
    Loop 条件
    ```
