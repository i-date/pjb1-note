# VBAのユーザーフォーム

## ユーザーフォームの基本

- 独自のフォームが作成可能
- ユーザーの入力を補助できる
- 注意: 表示状態は実行環境によって変わる場合がある(ディスプレイ解像度などが原因)

- VBE上挿入→ユーザーフォーム→ユーザーフォームダブルクリック→プレビュー/ツールボックス表示
- ツールボックスから、ユーザーフォーム上にドラッグ&ドロップでコントロールを配置
- コントロールは、VBEのプロパティウィンドウから各種プロパティを確認設定
- はじめに、ユーザーフォームのフォントを設定すると引き継がれるのでおすすめ

- ユーザーフォームの表示
  1. VBA Showメソッド: `ユーザーフォームオブジェクト.Show [表示モード]`
     - 表示モード1: vbModelessモードレスモード、フォーム表示中もセルなどの操作が可能
     - 表示モード2: vbModalモーダルモード、フォーム表示中にセルなどの操作ができない
  2. GUI操作
     - プロジェクトエクスプローラーでユーザーフォームを選択
     - ツールバーのSub/ユーザーフォームの実行ボタンを押す

- ユーザーフォームの非表示
  1. VBA Hideメソッド: `ユーザーフォームオブジェクト.Hide`
     - 値を保持
  2. VBA Unloadメソッド: `Unload ユーザーフォームオブジェクト`
     - 値をメモリから完全削除

- ユーザーフォームのモジュールと初期化処理
  - VBE上のフォームをダブルクリック→フォーム固有のオブジェクトモジュールが表示される
  - フォームやフォーム上に配置した各コントロールのイベント処理はここに記述する
  - 初期設定: Initializeイベント
  - フォームを閉じる際: QueryCloseイベント、Hideメソッドでは実行されない
  - 特にキャンセルしなくても良い場合: Terminateイベント

  ```vba
  'Initializeイベント
  Private Sub UserForm_Initialize()

    ComboBox1.List = Array("りんご", "みかん", "ぶどう")
    ComboBox1.ListIndex = 0

  End Sub

  'QueryCloseイベント
  Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)

      If MsgBox("本当に閉じてもいいんですか？ ", vbYesNo) = vbNo Then
          Cancel = 1 'キャンセルは「True」ではなく「1」を指定する
      End If

  End Sub
  ```

## 各コントロールの使用方法

- 多くのコントロールの共通設定
  - コントロールのオブジェクト名の末尾には、デフォルトだとインデックス番号がつけられる
  - アクセス方法1: `フォームのオブジェクト名.コントロールのオブジェクト名`
  - アクセス方法2 Controlsプロパティ: `フォームのオブジェクト.Controls("コントロールのオブジェクト名")`

- ラベルとテキストボックス
  - Labelオブジェクト
    - 表示キャプション設定 Captionプロパティ: `フォームのオブジェクト名.ラベルのオブジェクト名.Caption`
  - TextBoxオブジェクト
    - ユーザー入力設定 Textプロパティ: `フォームのオブジェクト名.テキストボックスのオブジェクト名.Text`

- ボタン
  - 既定のボタン: Enterキー押した際にClickイベントが発生
  - キャンセルボタン: Escキー押した際にClickイベントが発生
  - CommandButtonオブジェクト
    - Clickイベントが自動的に挿入
    - 任意のボタンを既定のボタンにする場合: DefaultプロパティをTrue
    - 任意のボタンをキャンセルのボタンにする場合: CancelプロパティをTrue
    - 改行のためEnterで規定のボタンのClickイベントを呼ばない場合: EnterKeyBehaviorプロパティをTrue

- チェックボックス
  - CheckBoxオブジェクト
    - 表示キャプション設定 Captionプロパティ
    - チェック状態設定 Valueプロパティ

- オプションボタン
  - 基本は複数選択肢の中から1つ選択
  - 異なる項目の選択を行いたい場合: Frameオブジェクト
  - OptionButtonオブジェクト
    - 選択状態設定 Valueプロパティ

- コンボボックス
  - ComboBoxオブジェクト
    - 表示リスト設定 Listプロパティ
    - 現在の選択項目の設定 ListIndexプロパティ(「0」から始まるインデックス)
    - 選択された値の取得 Textプロパティ
    - 直接リスト以外の項目を入力できる→ListIndexプロパティは「-1」を返す

- リストボックス
  - ListBoxオブジェクト
    - 表示項目リストの設定 Listプロパティ(1次元もしくは2次元配列の形で指定)
    - 2次元の場合の列数設定 ColumnCountプロパティ
    - 2次元の場合の列幅設定 ColumnWidthsプロパティ
    - 選択項目のインデックス番号取得設定 ListIndexプロパティ
    - 複数選択可能 MultiSelectプロパティ(fmMultiSelect列挙の定数で設定)
    - 個々のリスト項目の選択状態 Selectedプロパティ(配列で保持)
    - リストの動的更新
      - 追加 AddItemメソッド
      - 削除 RemoveItemメソッド

- タブオーダー
  - Tabキーを押すと次のコントロール、Shiftキー+Tabキーを押すと前のコントロールに移動
  - 各コントロールの移動する順番をタブオーダー
  - 対象コントロールに追加 各コントロールのTabStepプロパティをTrue
  - 対象コントロールの順番設定 TabIndexプロパティに「0」から始まるインデックスを振る
    - フレーム内コントロールは、そのフレーム内でタブオーダーを「0」から指定
