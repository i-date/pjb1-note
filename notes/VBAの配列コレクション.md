# VBAの配列・コレクション

## 配列

- `Range("B2:D2").Value = 3要素の配列`: 配列の値をまとめてセルに出力する例1
- `Range("B2:D5").Value = 4×3の配列`: 配列の値をまとめてセルに出力する例2
- `Option Base 1`: すべての配列インデックス番号を「1」から始める
- VBAは配列先頭のインデックスが可変な言語
- スピル形式で配列データを入力することも可能[^1]
- 大量のセルへの書き込みは、`For Each`よりも2次元配列を利用するほうが良い
  - ↑VBAはセルに値を代入する際に時間がかかるため、繰り返し代入処理を避けることで実行スピードを向上

- 配列情報を取得する関数
  - LBound: 配列先頭のインデックス番号を取得
  - UBound: 配列末尾のインデックス番号を取得
  - `UBound-LBound+1`: 配列長取得

- 宣言した要素数を処理の途中で変更
  - 動的配列宣言→`ReDim 配列名(サイズ)`
  - `ReDim Preserve 配列名(サイズ)`

- 配列作成・確認できる2つの関数
  - Split: 文字列→配列
  - Join: 配列→文字列(文字列を含む配列専用)

- シート上の値を2次元配列として取り出す
  - 要素数を指定せず宣言した配列に、セル範囲のValueプロパティ結果を代入

- `Array(要素1, 要素2, ...)`: 簡易リスト
  - 戻りを変数に代入する際はVariant型変数を使用
  - オブジェクトを扱う際、`Set`は不要
- Transposeワークシート関数: VBA内でセル範囲から取り出した2次元配列→行列を入れ替えた「一次元配列」に変換

## コレクション

- インデックス番号は「1」から始まる
- 宣言と初期化

  ```vba
  Dim コレクション名 As Collection
  Set コレクション名 = New Collection 'New演算子で初期化
  ```

- プロパティ/メソッド
  - Countプロパティ
  - Addメソッド: `コレクション.Add 値[, キー値][, Before:=][, After:=]`
  - Removeメソッド: `コレクション.Remove インデックス値`

## 連想配列(ハッシュテーブル)

- Collectionオブジェクトor外部ライブラリのDictionaryオブジェクト
- Addするとき、CollectionとDictionaryで値・キー値の順序が違うので注意

## スピル

- 数式を入力したセルから結果があふれて隣接したセルにも出力されるのがスピル
- スピル系のワークシート関数はVBAの配列にも適用可能
  - Sortワークシート関数: 配列の要素の並び替え
    - 返り値は元の配列と異なるソート済みの別配列
    - 複数キーを基準としたソートは配列で指定`WorksheetFunction.Sort(arr, Array(1,3), Array(1,-1))`
  - Indexワークシート関数: VBA側で作成した2次元配列をコピーした配列を作成

---
[^1]: ExcelVBA[完全]入門, pp.178-179
